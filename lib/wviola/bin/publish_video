#!/bin/bash

# This script has been generated automatically on the base of wviola.yml config file.
# DO NOT EDIT directly, unless you know what you are doing.
#
# To regenerate the scripts, run the task
#     symfony wviola:generate-scripts
#
# See
#     symfony help wviola:generate-scripts
#  
# for details

if [[ $# -lt 1 ]]; then
	echo $0 source
	exit 1
fi

UNIQID="$1"
ARTIST="$2"
TITLE="$3"
DATE="$4"
LOCATION="$5"
ORGANIZATION="$6"
COPYRIGHT="$7"
LICENSE="$8"
CONTACT="$9"
# these items come from the documentation of ffmpeg2theora

IFS=$'\n'
ffmpeg -y -i "/var/wviola/data/filesystem/scheduled/$UNIQID" -ar 22050 -ab 32000 -f flv -s 320x240 "/var/wviola/data/filesystem/published/assets/$UNIQID.flv" -y || exit 2
ffmpeg2theora --videoquality 8 -o "/var/wviola/data/filesystem/iso_images/cache/$UNIQID.ogv" "/var/wviola/data/filesystem/scheduled/$UNIQID" || exit 3

mv -v "/var/wviola/data/filesystem/scheduled/$UNIQID" "/var/wviola/data/filesystem/trash" || exit 4


echo 'PUBLISHED'

