<?php

#require 'lib/model/om/BaseAssetPeer.php';


/**
 * Skeleton subclass for performing query and update operations on the 'asset' table.
 *
 * 
 *
 * This class was autogenerated by Propel 1.4.0 on:
 *
 * Wed Feb  3 19:07:27 2010
 *
 * You should add additional methods to this class to meet the
 * application requirements.  This class will only be generated as
 * long as it does not already exist in the output directory.
 *
 * @package    lib.model
 */
class AssetPeer extends BaseAssetPeer {



  public static function retrieveByStatus($status)
  {
		$c=new Criteria();
		$c->add(AssetPeer::STATUS, $status);
		return AssetPeer::doSelect($c);
  }


	public static function retrieveByUniqid($uniqid)
	{
		$c=new Criteria();
		$c->add(AssetPeer::UNIQID, $uniqid);
		return AssetPeer::doSelectOne($c);
	}

	public static function retrieveBySourceSizeAndMd5sum($size, $md5sum)
	{
		$c=new Criteria();
		$c->add(AssetPeer::SOURCE_SIZE, $size);
		$c->add(AssetPeer::SOURCE_LMD5SUM, $md5sum);
		return AssetPeer::doSelectOne($c);
	}
  
  public static function doDeleteAll($con = null)
  {
    if (file_exists($index = Generic::getLuceneIndexFile('asset')))
    {
      sfToolkit::clearDirectory($index);
      rmdir($index);
    }
   
    return parent::doDeleteAll($con);
  }


  public static function getLuceneIndex()
  {
    return Generic::getLuceneIndex('asset');
  }
  
  static public function getForLuceneQuery($query, $max_results, $page)
  {
    try
    {
      // Lucene outputs a notice if the query is malformed... 
      $hits = @self::getLuceneIndex()->find($query);
    }
    catch (Exception $e)
    {
      return new sfPropelPager('Asset');
    }

    $pks = array();
    foreach ($hits as $hit)
    {
      $pks[] = $hit->pk;
    }
   
    $c = new Criteria();
    $c->add(self::ID, $pks, Criteria::IN);
//    $c->setLimit(wvConfig::get('search_max_results', 20));
    
    $pager = new sfPropelPager(
      'Asset',
      $max_results
    );
    
    $pager->setCriteria($c);
    $pager->setPage($page);
    $pager->init();
    
    return $pager;
  }

} // AssetPeer

